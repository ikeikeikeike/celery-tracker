from tracker.configs.celeryconfig import CELERY_TRACKER_PLUGINS
from tracker.tracking.storage import EventStorage

try:
    from .utils import MockStorage
except (ImportError, ValueError):
    from tests.utils import MockStorage


events_full = [{'None': {'pid': 51213, 'result': None, 'uuid': '943ab842-a97a-4b1e-a043-37d46f64fc96', 'clock': 990, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'STARTED', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470983.8456531, 'timestamp': 1347470983.8456531, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'None': {'pid': 51213, 'result': "'slow'", 'uuid': '5fa25e1f-af86-4192-8d16-c4e63f625729', 'clock': 989, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'SUCCESS', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470973.842397, 'timestamp': 1347470983.8424759, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': 1347470983.8424759, 'traceback': None, 'eta': None, 'retried': False, 'runtime': 10.001110076904297}}, {'None': {'pid': 51220, 'result': None, 'uuid': '5de5c06d-f7c5-4710-ae28-3b908fff4bab', 'clock': 987, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'STARTED', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470983.8363681, 'timestamp': 1347470983.8363681, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'None': {'pid': 51220, 'result': "'slow'", 'uuid': '2271c5f4-1bb7-405f-8fc2-f8d1d82db0c9', 'clock': 986, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'SUCCESS', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470973.827857, 'timestamp': 1347470983.835443, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': 1347470983.835443, 'traceback': None, 'eta': None, 'retried': False, 'runtime': 10.008655071258545}}, {'None': {'pid': 51221, 'result': None, 'uuid': 'fae60a58-0eab-4ab0-aa0b-30ffd876ffc6', 'clock': 984, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'STARTED', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470983.8221531, 'timestamp': 1347470983.8221531, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'None': {'pid': 51221, 'result': "'slow'", 'uuid': '2f21f106-51b9-4aaa-b298-5811a34b2419', 'clock': 983, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'SUCCESS', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470973.8213699, 'timestamp': 1347470983.8211751, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': 1347470983.8211751, 'traceback': None, 'eta': None, 'retried': False, 'runtime': 10.000733137130737}}, {'None': {'pid': 51219, 'result': None, 'uuid': 'e0bd466d-4246-4656-a6d5-a535ede2afee', 'clock': 981, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'STARTED', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470983.793673, 'timestamp': 1347470983.793673, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'None': {'pid': 51219, 'result': "'slow'", 'uuid': '9795bf09-7695-4362-8176-1bde8e88b610', 'clock': 980, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'SUCCESS', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470973.793272, 'timestamp': 1347470983.792408, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': 1347470983.792408, 'traceback': None, 'eta': None, 'retried': False, 'runtime': 10.000398874282837}}, {'None': {'pid': 51216, 'result': None, 'uuid': '562165ee-8690-4e2c-b3e6-34f280d097d5', 'clock': 978, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'STARTED', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470983.7181439, 'timestamp': 1347470983.7181439, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'None': {'pid': 51216, 'result': "'slow'", 'uuid': '5dcb9fce-36ca-421c-9777-cb2ebc6e3829', 'clock': 977, 'routing_key': None, 'retries': None, 'failed': False, 'state': 'SUCCESS', 'kwargs': None, 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470973.717963, 'timestamp': 1347470983.717304, 'args': None, 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': None, 'received': False, 'exception': None, 'revoked': False, 'succeeded': 1347470983.717304, 'traceback': None, 'eta': None, 'retried': False, 'runtime': 10.00045108795166}}, {'fast.tasks.fast': {'pid': 51212, 'result': "'fast'", 'uuid': '02904763-d7f2-4b3f-ad99-64e7b904b98d', 'clock': 524, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'SUCCESS', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470987.968117, 'timestamp': 1347470987.9691391, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 521, 'heartbeats': [1347470987.9691391], 'hostname': 'vagrant-ubuntu-precise.fast-worker', 'sw_ver': '3.0.9', 'processed': 146, 'active': 0, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'fast.tasks.fast', 'received': 1347470987.9595571, 'exception': None, 'revoked': False, 'succeeded': 1347470987.9691391, 'traceback': None, 'eta': None, 'retried': False, 'runtime': 0.0019578933715820312}}, {'fast.tasks.fast': {'pid': 51212, 'result': "'fast'", 'uuid': '1475a93f-3ed9-42fb-8e7f-68fd7958448a', 'clock': 520, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'SUCCESS', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470982.9719701, 'timestamp': 1347470982.9739871, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 521, 'heartbeats': [1347470987.9691391], 'hostname': 'vagrant-ubuntu-precise.fast-worker', 'sw_ver': '3.0.9', 'processed': 146, 'active': 0, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'fast.tasks.fast', 'received': 1347470982.948473, 'exception': None, 'revoked': False, 'succeeded': 1347470982.9739871, 'traceback': None, 'eta': None, 'retried': False, 'runtime': 0.0056390762329101562}}, {'fast.tasks.fast': {'pid': 51217, 'result': "'fast'", 'uuid': '65735eb1-385a-4b9f-ae23-e39cc915dc81', 'clock': 516, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'SUCCESS', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': 1347470977.964838, 'timestamp': 1347470977.9666531, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 521, 'heartbeats': [1347470987.9691391], 'hostname': 'vagrant-ubuntu-precise.fast-worker', 'sw_ver': '3.0.9', 'processed': 146, 'active': 0, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'fast.tasks.fast', 'received': 1347470977.9426811, 'exception': None, 'revoked': False, 'succeeded': 1347470977.9666531, 'traceback': None, 'eta': None, 'retried': False, 'runtime': 0.0041339397430419922}}, {'slow.tasks.slow': {'result': None, 'uuid': 'e25010de-6961-47fa-b268-91fe19e7d8bb', 'clock': 991, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470983.8478279, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470983.8478279, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': 'b189dc07-ba58-47d4-9436-e575bc536b86', 'clock': 988, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470983.8403749, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470983.8403749, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '3d44bfcc-be18-4579-9dc6-0d073b1fc2a8', 'clock': 985, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470983.8269391, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470983.8269391, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': 'e66a0ca0-9a99-4810-8de9-f12ae59523a7', 'clock': 982, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470983.7957261, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470983.7957261, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': 'db9b5e81-f314-431b-b4c6-e452cdaca9cf', 'clock': 979, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470983.722084, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 992, 'heartbeats': [1347470977.0009589, 1347470982.001369, 1347470987.002224], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 300, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470983.722084, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '06613c1a-152d-4ded-b175-dd5d641b469a', 'clock': 974, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470973.844666, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470973.844666, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '970c4f3d-7ced-435d-8b05-fb24f57a2064', 'clock': 971, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470973.8312161, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470973.8312161, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '310b064f-c24b-48de-825e-6d4cbf6613cb', 'clock': 968, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470973.8238881, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470973.8238881, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '72fed0ad-1f30-4ef9-99e2-bfc4789719df', 'clock': 965, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470973.7959361, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470973.7959361, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '4e000857-0f9f-454c-943e-9cac9e314b20', 'clock': 962, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470973.720928, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470973.720928, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': 'cf178be5-2baa-4adf-8794-277ed646ef69', 'clock': 958, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470963.8616569, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470963.8616569, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '18853c11-dc8b-41f1-8f29-a53cb4403d4c', 'clock': 957, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470963.85851, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470963.85851, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '54275aef-6d44-4b6a-b261-5cbe87e76aa9', 'clock': 956, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470963.849916, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470963.849916, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '3b87acb3-1fce-4d05-ada5-f61a9e0e3ad0', 'clock': 953, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470963.8423901, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470963.8423901, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}, {'slow.tasks.slow': {'result': None, 'uuid': '21e2ca70-59de-45b9-98b9-50c1584fad26', 'clock': 946, 'routing_key': None, 'retries': 0, 'failed': False, 'state': 'RECEIVED', 'kwargs': '{}', 'sent': False, 'expires': None, 'exchange': None, 'started': False, 'timestamp': 1347470963.7260339, 'args': '[]', 'worker': {'sw_sys': 'Darwin', 'clock': 959, 'heartbeats': [1347470983.792408, 1347470983.8211751, 1347470983.835443, 1347470983.8424759], 'hostname': 'vagrant-ubuntu-precise.slow-worker', 'sw_ver': '3.0.9', 'processed': 290, 'active': 5, 'freq': 5.0, 'sw_ident': 'py-celery'}, 'name': 'slow.tasks.slow', 'received': 1347470963.7260339, 'exception': None, 'revoked': False, 'succeeded': False, 'traceback': None, 'eta': None, 'retried': False, 'runtime': None}}]


def get_events():
    dic = {"retries": 4 , "runtime": 0.21212, "worker": 8}
    return [{"retries": dic , "runtime": dic, "worker": dic} for i in range(0, 10)]


def test_dict():
    storage = EventStorage(plugins=CELERY_TRACKER_PLUGINS, storage={})
    dic = storage._to_dict(dict(a=1, b=2, c=3, d=4, e=5))
    assert(isinstance(dic, (dict, )))


def test_average():
    storage = EventStorage(plugins=CELERY_TRACKER_PLUGINS, storage={})
    average = storage._to_average(get_events())
    assert average["number_of_retries"] == 10
    assert average["retry_sum_retries"] == 40
    assert average["runtime_retries"] == 0.21212000000000003


def test_average2():
    storage = EventStorage(plugins=CELERY_TRACKER_PLUGINS, storage={})
    average = storage._to_average(events_full)
#    assert average["number_of_retries"] == 10
#    assert average["retry_sum_retries"] == 40
#    assert average["runtime_retries"] == 0.21212000000000003

def test_merge():
    mock_storage = MockStorage()
    storage = EventStorage(plugins=CELERY_TRACKER_PLUGINS, storage={})
    event1 = mock_storage.event()
    event2 = storage._merge_events(event1, get_events(), get_events())
    for k1, k2 in zip(event1, event2):
        data1, data2 = event1[k1], event2[k2]
        assert k1 == k2
        assert type(data1) == type(data2)
